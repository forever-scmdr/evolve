<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE stylesheet [<!ENTITY nbsp "&#160;"><!ENTITY copy "&#x000A9;" >]><xsl:stylesheet		xmlns:xsl="http://www.w3.org/1999/XSL/Transform"		xmlns:f="f:f"		version="2.0">	<xsl:import href="utils/price_conversions.xsl"/>	<xsl:output method="html" encoding="UTF-8" media-type="text/xhtml" indent="yes" omit-xml-declaration="yes"/>	<xsl:variable name="cart" select="page/cart"/>	<xsl:template match="/">		<xsl:if test="$cart and (not($cart/processed) or $cart/processed != 1) and $cart/bought">			<div class="result" id="cart_ajax">				<xsl:if test="f:num($cart/sum) &gt; 0">					<a href="{page/show_cart}"><i class="fas fa-shopping-cart"></i>Корзина</a>					<div>Наименований: <strong><xsl:value-of select="count($cart/bought)"/></strong></div>					<div>Сумма: <strong><xsl:value-of select="f:cart_sum($cart/sum)"/>.</strong></div>				</xsl:if>				<xsl:if test="f:num($cart/sum) = 0">					<a href="{page/show_cart}"><i class="fas fa-shopping-cart"></i>Корзина</a>					<div>Наименований: <strong><xsl:value-of select="count($cart/bought)"/></strong></div>					<div>Сумма по запросу</div>				</xsl:if>			</div>			<xsl:for-each select="$cart/bought">				<xsl:variable name="id" select="if(f:num(product/@id) &gt; 0) then product/@id else item_own_extras/id"/>				<div class="result" id="cart_list_{$id}">					<form>						<input type="submit" value="Оформить заявку" class="button to_cart" onclick="location.replace('{//page/show_cart}'); return false"/>					</form>				</div>			</xsl:for-each>		</xsl:if>		<xsl:if test="not($cart) or $cart/processed = 1 or not($cart/bought)">			<div class="result" id="cart_ajax">				<i class="fas fa-shopping-cart"/> <strong>Корзина пуста</strong>			</div>		</xsl:if>		<div id="cart-bought-list" class="result">			<xsl:apply-templates select="$cart/bought[f:num(sum) != 0]" mode="avlb"/>			<xsl:if test="page/cart/bought[f:num(sum) = 0] or page/cart/bought[f:num(qty_avail) = 0]">				<h2>Товары под заказ</h2>				<xsl:apply-templates select="$cart/bought" mode="preorder"/>			</xsl:if>		</div>	</xsl:template>	<xsl:template match="bought" mode="avlb">		<xsl:variable name="aux" select="aux"/>		<xsl:variable name="is_aux" select="aux != ''"/>		<xsl:variable name="shop" select="/page/shop[name = $aux]"/>		<xsl:variable name="p" select="product"/>		<xsl:variable name="price"  select="f:cart_sum(price)"/>		<xsl:variable name="sum"  select="f:cart_sum(sum)"/>		<xsl:variable name="img"  select="if(item_own_extras/img != '') then item_own_extras/img else 'img/no_image.png'"/>		<div class="item">			<xsl:if test="$is_aux">				<span class="image-container">					<img src="{$img}" alt="{$p/name}"/>				</span>				<span class="title">					<xsl:value-of select="$p/name"/>					<xsl:if test="$is_aux">						<br/>						<span style="color: #000;">поставка в течение <xsl:value-of select="$shop/delivery_string"/></span>					</xsl:if>				</span>			</xsl:if>			<xsl:if test="not($is_aux)">				<a href="{$p/show_product}" class="image-container">					<img src="{$img}" alt="{$p/name}"/>				</a>				<a href="{$p/show_product}" class="title">					<xsl:value-of select="$p/name"/>				</a>			</xsl:if>			<div class="quantity">				<span>Кол-во</span>				<input type="number" value="{qty}" name="{input/qty/@input}" min="{product/min_qty}"					   step="{product/min_qty}" class="qty-input" data-old="{qty}"/>				<br/>				<span>Наличие</span>				доступно:				<xsl:value-of select="f:num($p/qty)"/>			</div>			<div class="price one">				<p>					<span>Цена</span>					<xsl:value-of select="$price"/>					<xsl:if test="$p/spec_price">						<xsl:variable name="sq" select="$p/spec_qty"/>						<xsl:variable name="x">							<xsl:for-each select="$p/spec_price">								<xsl:variable name="pos" select="position()"/>								<xsl:variable name="q" select="$sq[$pos]"/>								<xsl:variable name="display_spec" select="f:price_ictrade(.)"/>								<xsl:value-of select="concat($q, '+ ', '&lt;strong&gt;', $display_spec,' ', upper-case($curr), '&lt;/strong&gt;', '&lt;br/&gt;')"/>							</xsl:for-each>						</xsl:variable>						<br/>						<a data-container="body" data-html="true" data-toggle="popover" data-placement="top" data-content="{$x}" style="font-size:12px;">подробнее</a>					</xsl:if>				</p>			</div>			<div class="price all">				<p>					<span>Сумма позиц.</span>					<xsl:value-of select="$sum"/>				</p>			</div>			<a href="{delete}" class="delete">				<i class="fas fa-times"/>			</a>		</div>	</xsl:template>	<xsl:template match="bought" mode="preorder">		<xsl:if test="f:num(product/price) = 0 or f:num(qty_avail) = 0">			<xsl:variable name="p" select="product" />			<xsl:variable name="is_aux" select="aux != ''" />			<xsl:variable name="img" select="if(item_own_extras/img != '') then item_own_extras/img else 'img/no_image.png'"/>			<xsl:variable name="main_pic" select="if($p/main_pic != '') then concat($p/@path, $p/main_pic) else 'img/no_image.png'"/>			<div class="item">				<xsl:if test="$is_aux">					<span class="image-container">						<img src="{$img}" alt="{$p/name}"/>					</span>					<span class="title">						<xsl:value-of select="$p/name"/> (<xsl:value-of select="$p/product/name" />)					</span>				</xsl:if>				<xsl:if test="not($is_aux)">					<a href="{$p/show_product}" class="image-container">						<img src="{$main_pic}" alt="{$p/name}"/>					</a>					<a href="{$p/show_product}" class="title">						<xsl:value-of select="$p/name"/>					</a>				</xsl:if>				<div class="quantity">					<span>Кол-во</span>					<input type="number" value="{qty}" name="{input/qty/@input}" min="1" class="qty-input" data-old="{qty}" />				</div>				<div class="price one">					<p>						<span>Цена</span>						-					</p>				</div>				<div class="price all"><p><span>Сумма позиц.</span> - </p></div>				<a href="{delete}" class="delete"><i class="fas fa-times"/></a>			</div>		</xsl:if>	</xsl:template></xsl:stylesheet>