<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE stylesheet [<!ENTITY nbsp "&#160;"><!ENTITY copy "&#x000A9;" >]><xsl:stylesheet 	xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 	xmlns:ext="http://exslt.org/common"	version="2.0"	xmlns:f="f:f"	exclude-result-prefixes="xsl ext">	<xsl:import href="utils/price_conversions.xsl"/>	<xsl:output method="xml" encoding="UTF-8" media-type="text/xml" indent="yes" />	<xsl:variable name="is_jur" select="not(page/user_jur/input/organization = '')"/>	<xsl:variable name="is_phys" select="not($is_jur)"/>	<xsl:variable name="cart" select="page/cart"/>	<xsl:variable name="contacts" select="if ($is_jur) then page/user_jur/input else page/user_phys/input"/>	<xsl:variable name="main_host" select="if(page/url_seo_wrap/main_host != '') then page/url_seo_wrap/main_host else page/base" />	<xsl:template match="/">		<order>			<date>				<xsl:value-of select="f:format_date(current-date())"/>			</date>			<number>				<xsl:value-of select="$cart/order_num"/>			</number>			<sum>				<xsl:value-of select="f:num($cart/sum)"/>			</sum>			<list>				<xsl:for-each select="$cart/bought[f:num(qty_avail) &gt; 0]">					<xsl:variable name="p" select="product"/>					<product>						<name><xsl:value-of select="$p/name"/></name>						<code><xsl:value-of select="$p/code"/></code><!-- Основной артикул -->						<qty><xsl:value-of select="f:num(qty_avail)"/></qty><!-- Количество -->						<price><xsl:value-of select="f:num($p/price)"/></price><!-- Цена единицы -->						<sum><xsl:value-of select="f:num(sum)"/></sum><!-- Сумма с учетом количества -->						<available>1</available><!-- В наличии (1) товар или под заказ (0) -->					</product>				</xsl:for-each>			</list>			<not_avaiable>				<xsl:for-each select="$cart/bought[not_available = '1']">					<xsl:variable name="p" select="product"/>					<product>						<name><xsl:value-of select="$p/name"/></name>						<code><xsl:value-of select="$p/code"/></code><!-- Основной артикул -->						<qty><xsl:value-of select="f:num(qty_total) - f:num(qty_avail)"/></qty><!-- Количество -->						<available><xsl:value-of select="if (qty_avail != '0') then '1' else '0'"/></available><!-- В наличии (1) товар или под заказ (0) -->					</product>				</xsl:for-each>			</not_avaiable>			<xsl:if test="$is_jur">				<jur>					<email><xsl:value-of select="$contacts/email"/></email>					<phone><xsl:value-of select="$contacts/phone"/></phone>					<organization><xsl:value-of select="$contacts/organization"/></organization>					<contact_name><xsl:value-of select="$contacts/contact_name"/></contact_name><!-- Контактное лицо -->					<contact_phone><xsl:value-of select="$contacts/contact_phone"/></contact_phone><!-- Телефон контактного лица -->					<address><xsl:value-of select="$contacts/address"/></address>					<!--<ship_type><xsl:value-of select="$contacts/ship_type"/></ship_type>-->					<!--<pay_type><xsl:value-of select="$contacts/pay_type"/></pay_type>-->					<account><xsl:value-of select="$contacts/account"/></account><!-- Номер счета в банке -->					<bank><xsl:value-of select="$contacts/bank"/></bank><!-- Название банка -->					<bank_address><xsl:value-of select="$contacts/bank_address"/></bank_address>					<bank_code><xsl:value-of select="$contacts/bank_code"/></bank_code>					<unp><xsl:value-of select="$contacts/unp"/></unp>					<director><xsl:value-of select="$contacts/director"/></director><!-- ФИО директора -->					<base><xsl:value-of select="$contacts/base"/></base><!-- Если нужно, то заполняется Действует на основании (имеется в виду директор) -->					<comment><xsl:value-of select="$contacts/comment"/></comment>				</jur>			</xsl:if>			<xsl:if test="$is_phys">				<phys>					<email><xsl:value-of select="$contacts/email"/></email>					<phone><xsl:value-of select="$contacts/phone"/></phone>					<name><xsl:value-of select="$contacts/name"/></name>					<address><xsl:value-of select="$contacts/address"/></address>					<!--<ship_type><xsl:value-of select="$contacts/ship_type"/></ship_type>-->					<!--<pay_type><xsl:value-of select="$contacts/pay_type"/></pay_type>-->					<comment><xsl:value-of select="$contacts/comment"/></comment>				</phys>			</xsl:if>		</order>	</xsl:template></xsl:stylesheet>