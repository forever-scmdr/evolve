<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE stylesheet [<!ENTITY nbsp "&#160;"><!ENTITY copy "&#x000A9;" >]><xsl:stylesheet 	xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 	xmlns:saxon="http://saxon.sf.net/"	xmlns:ext="http://exslt.org/common"	version="2.0"	xmlns:f="f:f"	exclude-result-prefixes="xsl saxon ext f">	<xsl:import href="price_conversions.xsl"/>	<xsl:output method="xml" encoding="UTF-8" media-type="application/xml" indent="yes" omit-xml-declaration="yes"/><xsl:variable name="cart" select="page/cart"/><xsl:variable name="contacts" select="page/cart_contacts"/><xsl:variable name="url_base" select="page/variables/url_base"/><xsl:variable name="is_phys" select="not($contacts/organization and not($contacts/organization = ''))"/><xsl:template match="/"><order num="{page/variables/order_num}">	<positions><xsl:value-of select="count($cart/bought)"/></positions>	<sum><xsl:value-of select="$cart/sum"/></sum>	<sum_words><xsl:value-of select="f:rub_kop($cart/sum)"/></sum_words>	<sum_no_discount><xsl:value-of select="$cart/simple_sum"/></sum_no_discount>	<discount_percent><xsl:value-of select="$cart/discount"/></discount_percent>	<discount><xsl:value-of select="$cart/margin"/></discount>	<xsl:if test="$is_phys">	<phys send-by-mail="{if ($contacts/need_post_address = 'да') then 'yes' else 'no'}">		<data name="Фамилия"><xsl:value-of select="$contacts/second_name"/></data>		<data name="Имя"><xsl:value-of select="$contacts/name"/></data>		<data name="Телефон"><xsl:value-of select="$contacts/phone"/></data>		<data name="E-mail"><xsl:value-of select="$contacts/email"/></data>		<data name="Адрес доставки почтой"><xsl:value-of select="$contacts/post_index"/><xsl:text> </xsl:text><xsl:value-of select="$contacts/post_city"/><xsl:text> </xsl:text><xsl:value-of select="$contacts/post_address"/></data>		<data name="Дополнительно"><xsl:value-of select="$contacts/phys_message"/></data>		<data name="В случае отсутствия некоторых позиций"><xsl:value-of select="$contacts/if_absent"/></data>		<data name="Пункт самовывоза"><xsl:value-of select="$contacts/get_order_from"/></data>	</phys>	</xsl:if>	<xsl:if test="not($is_phys)">	<jur send-by-mail="{if ($contacts/jur_need_post_address = 'да') then 'yes' else 'no'}" has-no-bank="{if ($contacts/no_account = 'да') then 'yes' else 'no'}">		<data name="Организация"><xsl:value-of select="$contacts/organization"/></data>		<data name="Телефон/факс"><xsl:value-of select="$contacts/jur_phone"/></data>		<data name="Электнонный адрес"><xsl:value-of select="$contacts/jur_email"/></data>		<data name="Отправить договор на этот"><xsl:value-of select="$contacts/send_contract_to"/></data>		<data name="Контактное лицо"><xsl:value-of select="$contacts/contact_name"/></data>		<data name="Телефон контактного лица"><xsl:value-of select="$contacts/contact_phone"/></data>		<data name="Адрес доставки почтой"><xsl:value-of select="$contacts/jur_post_address"/></data>		<data name="Юр. адрес"><xsl:value-of select="$contacts/address"/></data>		<data name="Расчетный счет"><xsl:value-of select="$contacts/account"/></data>		<data name="Название банка"><xsl:value-of select="$contacts/bank"/></data>		<data name="Адрес банка"><xsl:value-of select="$contacts/bank_address"/></data>		<data name="Код банка"><xsl:value-of select="$contacts/bank_code"/></data>		<data name="УНП"><xsl:value-of select="$contacts/unp"/></data>		<data name="Ф.И.О директора (индивидуального предпринимателя)"><xsl:value-of select="$contacts/director"/></data>		<data name="Действует на основании"><xsl:value-of select="$contacts/base"/></data>		<data name="Номер доверенности"><xsl:value-of select="$contacts/base_number"/></data>		<data name="Дата выдачи доверенности"><xsl:value-of select="$contacts/base_date"/></data>		<data name="Цель приобретения"><xsl:value-of select="$contacts/jur_aim"/></data>		<data name="Источник финансирования"><xsl:value-of select="$contacts/jur_fund"/></data>		<data name="Дополнительно"><xsl:value-of select="$contacts/jur_message"/></data>	</jur>	</xsl:if>	<in_store>	<xsl:for-each select="$cart/bought[product/qty != '0']">		<xsl:sort select="type"/>		<product code="{product/code}" store-b="{product/qty1}" store-s="{product/qty2}" qty="{quantity}" unit="{product/unit}" price="{product/price}" sum="{sum}" special="{if (product/special_price = 'true') then 'true' else 'false'}">			<position><xsl:value-of select="position()"/></position>			<name><xsl:value-of select="product/name"/></name>			<mark><xsl:value-of select="product/mark"/></mark>		</product>	</xsl:for-each>	</in_store>	<not_in_store>	<xsl:for-each select="$cart/bought[product/qty = '0']">	<xsl:sort select="type"/>		<product code="{product/code}" qty="{quantity}" unit="{product/unit}" old-price="{product/price}">			<position><xsl:value-of select="position()"/></position>			<name><xsl:value-of select="product/name"/></name>			<mark><xsl:value-of select="product/mark"/></mark>		</product>		</xsl:for-each>	</not_in_store>	<personal>	<xsl:for-each select="$cart/custom_bought[nonempty = 'true']">		<xsl:sort select="position"/>		<product>			<mark><xsl:value-of select="mark"/></mark>			<type><xsl:value-of select="type"/></type>			<case><xsl:value-of select="case"/></case>			<qty><xsl:value-of select="qty"/></qty>			<link><xsl:value-of select="link"/></link>			<extra><xsl:value-of select="extra"/></extra>		</product>	</xsl:for-each>	</personal></order></xsl:template></xsl:stylesheet>