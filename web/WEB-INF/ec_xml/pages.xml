<?xml version="1.0" encoding="UTF-8"?>
<site>

<!-- ******************************* Включение для разделов каталога ****************************** -->

	<page name="index">
		<single item="catalog">
			<tree item="section">
				<list item="product" assoc="contains"/>
			</tree>
		</single>
	</page>


	<page name="downloaded">
		<list item="parse_item" tag="NEW">
			<filter>
				<parameter name="duplicated"><var value="0"/></parameter>
				<limit><var value="0"/></limit>
			</filter>
		</list>
		<list item="parse_item" tag="DUPLICATED">
			<filter>
				<parameter name="duplicated"><var value="1"/></parameter>
			</filter>
		</list>
	</page>


	<!--///////////////////////////////////////////////////////////////////////////////////////////////-->
	<!--/////////////                                                                      ////////////-->
	<!--/////////////                             ПАРСИНГ                                  ////////////-->
	<!--/////////////                                                                      ////////////-->
	<!--///////////////////////////////////////////////////////////////////////////////////////////////-->

	<!--//                                                                                                  -->
	<!--// Команда для получения HTML, его преобразования и скачивания файлов (в зависимости от параметров) -->
	<!--//                                                                                                  -->
	<page name="get_site" template="get_site" authority-groups="common">
		<request>
			<var name="action"/>
			<var name="stage" value="INIT"/>
		</request>
		<command class="lunacrawler.SingleCrawlerCommand" clear-cache="no">
			<result name="complete" type="xml"/>
		</command>
	</page>

	<!--//                                                                                                  -->
	<!--// Тестовая страница для проверки XSLT преобразования (ссылка берется из айтема parse_item в CMS)   -->
	<!--//                                                                                                  -->
	<page name="test_parse_item">
		<request>
			<var name="pi"/>
		</request>
		<single item="parse_item" var="pi" id="pi"/>
		<command class="lunacrawler.TestParseItemCommand" clear-cache="no">
			<result name="test" type="xml"/>
		</command>
	</page>

	<!--//                                                                          -->
	<!--// Интеграция полученных данных, хранящихся в айтемах parse_item на сайт    -->
	<!--//                                                                          -->
	<page name="deploy_parsed" template="deploy_parsed" authority-groups="common">
		<request>
			<var name="action"/>
		</request>
		<list item="section" id="sec">
			<list item="parse_item" id="pi"/>
		</list>
		<command class="extra.DeployParsed" clear-cache="yes">
			<result name="complete" type="xml"/>
		</command>
	</page>
</site>