<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE stylesheet [<!ENTITY nbsp "&#160;"><!ENTITY copy "&#x000A9;" >]><xsl:stylesheet 	xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 	xmlns:ext="http://exslt.org/common"	xmlns="http://www.w3.org/1999/xhtml"	version="2.0"	xmlns:f="f:f"	exclude-result-prefixes="xsl ext">	<xsl:import href="utils/utils.xsl"/>	<xsl:output method="html" encoding="UTF-8" media-type="text/plain" indent="yes" omit-xml-declaration="yes"/>	<xsl:variable name="registration" select="page/registration[f:num(@id) &gt; 0]"/>	<xsl:variable name="is_reg_jur" select="$registration/@type = 'user_jur'"/>	<xsl:variable name="is_jur" select="true()"/>	<xsl:variable name="cart" select="page/cart"/>	<xsl:variable name="contacts" select="if (not(page/user_jur/input/email = '')) then page/user_jur/input else $registration"/>	<xsl:variable name="main_host" select="if(page/url_seo_wrap/main_host != '') then page/url_seo_wrap/main_host else page/base" />	<xsl:param name="pPat">"</xsl:param>	<xsl:param name="pRep">'</xsl:param>	<xsl:template match="/">{"order_num":"<xsl:value-of select="$cart/order_num"/>","position_qty":<xsl:value-of select="count($cart/bought)"/>,"sum":<xsl:value-of select="f:num($cart/sum)"/>,	"customer":{	"email":"<xsl:value-of select="$contacts/email"/>",	"inn":"<xsl:value-of select="$contacts/inn"/>",	"organization":"<xsl:value-of select="translate($contacts/organization, $pPat, $pRep)"/>",	"kpp":"<xsl:value-of select="$contacts/kpp"/>",	"address":"<xsl:value-of select="translate($contacts/address, $pPat, $pRep)"/>",	"corp_email":"<xsl:value-of select="$contacts/corp_email"/>",	"phone":"<xsl:value-of select="$contacts/phone"/>",	"boss":"<xsl:value-of select="$contacts/boss"/>",	"boss_position":"<xsl:value-of select="$contacts/boss_position"/>",	"ship_type":"<xsl:value-of select="$contacts/ship_type"/>",	"pay_type":"<xsl:value-of select="$contacts/pay_type"/>",	"comment":"<xsl:value-of select="$contacts/comment"/>"},	"positions":[	<xsl:for-each select="$cart/bought">		<xsl:variable name="product" select="product"/>		<xsl:variable name="has_price" select="if ($is_reg_jur) then ($product/price_opt and $product/price_opt != '0') else ($product/price and $product/price != '0')"/><!--        <xsl:variable name="price" select="if (f:num($product/price) != 0) then f:exchange(., 'price', 0) else 'по запросу'"/>--><!--        <xsl:variable name="sum" select="if (f:num($product/price) != 0) then f:exchange(., 'sum', 0) else ''"/>-->		<xsl:variable name="price" select="price"/>		<xsl:variable name="sum" select="sum"/>        <xsl:if test="position() &gt; 1">,</xsl:if>{"code":"<xsl:value-of select="$product/code"/>",		"name":"<xsl:value-of select="$product/name"/>",		"manufacturer":"<xsl:value-of select="$product/vendor"/>",		"vendor":"<xsl:value-of select="$product/category_id"/>",		"leadtimedays":"<xsl:value-of select="$product/next_delivery"/>",		"qty_ordered":<xsl:value-of select="f:num(qty)"/>,		"quantity":<xsl:value-of select="f:num($product/qty)"/>,		"price":"<xsl:value-of select="$price"/>",		"sum":"<xsl:value-of select="$sum"/>"}	</xsl:for-each>	]}</xsl:template></xsl:stylesheet>