<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE stylesheet [<!ENTITY nbsp "&#160;"><!ENTITY copy "&#x000A9;" >]><xsl:stylesheet 	xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 	xmlns:ext="http://exslt.org/common"	xmlns="http://www.w3.org/1999/xhtml"	version="2.0"	xmlns:f="f:f"	exclude-result-prefixes="xsl ext">	<xsl:import href="utils/utils.xsl"/>	<xsl:output method="html" encoding="UTF-8" media-type="text/plain" indent="yes" omit-xml-declaration="yes"/>	<xsl:variable name="is_jur" select="not(page/user_jur/input/organization = '')"/>	<xsl:variable name="is_phys" select="not($is_jur)"/>	<xsl:variable name="cart" select="page/cart"/>	<xsl:variable name="contacts" select="if ($is_jur) then page/user_jur/input else page/user_phys/input"/>	<xsl:variable name="main_host" select="if(page/url_seo_wrap/main_host != '') then page/url_seo_wrap/main_host else page/base" />	<xsl:variable name="registration" select="page/registration[f:num(@id) &gt; 0]"/>	<xsl:variable name="is_reg_jur" select="$registration/@type = 'user_jur'"/>	<xsl:template match="/">	{"order_num":"<xsl:value-of select="$cart/order_num"/>","position_qty":<xsl:value-of select="count($cart/bought)"/>,"sum":<xsl:value-of select="f:num($cart/sum)"/>,"customer":{<xsl:if test="$is_phys">	"type":"phys",	"name":"<xsl:value-of select="$contacts/name"/>",	"phone":"<xsl:value-of select="$contacts/phone"/>",	"email":"<xsl:value-of select="$contacts/email"/>",	"address":"<xsl:value-of select="$contacts/address"/>",	"ship_type":"<xsl:value-of select="$contacts/ship_type"/>",	"pay_type":"<xsl:value-of select="$contacts/pay_type"/>",	"comment":"<xsl:value-of select="$contacts/comment"/>"},</xsl:if><xsl:if test="not($is_phys)">	"type":"jur",	"organization":"<xsl:value-of select="$contacts/organization"/>",	"phone":"<xsl:value-of select="$contacts/phone"/>",	"email":"<xsl:value-of select="$contacts/email"/>",	"contact_name":"<xsl:value-of select="$contacts/contact_name"/>",	"contact_phone":"<xsl:value-of select="$contacts/contact_phone"/>",	"ship_type":"<xsl:value-of select="$contacts/ship_type"/>",	"pay_type":"<xsl:value-of select="$contacts/pay_type"/>",	"address":"<xsl:value-of select="$contacts/address"/>",<xsl:if test="not($contacts/no_account = 'да')">	"bank_account":"<xsl:value-of select="$contacts/account"/>",	"bank":"<xsl:value-of select="$contacts/bank"/>",	"bank_address":"<xsl:value-of select="$contacts/bank_address"/>",	"bank_code":"<xsl:value-of select="$contacts/bank_code"/>",</xsl:if><xsl:if test="$contacts/no_account = 'да'">	"bank_account":"no",</xsl:if>	"unp":"<xsl:value-of select="$contacts/unp"/>",	"director":"<xsl:value-of select="$contacts/director"/>",	"base":"<xsl:value-of select="$contacts/base"/>",	"base_date":"<xsl:value-of select="$contacts/base_date"/>",	"comment":"<xsl:value-of select="$contacts/comment"/>"},</xsl:if>	"positions":[	<xsl:for-each select="$cart/bought">		<xsl:variable name="product" select="product"/>		<xsl:variable name="has_price" select="if ($is_reg_jur) then ($product/price_opt and $product/price_opt != '0') else ($product/price and $product/price != '0')"/>		<xsl:if test="position() &gt; 1">,</xsl:if>{"code":"<xsl:value-of select="$product/code"/>",		"name":"<xsl:value-of select="$product/name"/>",		"qty":<xsl:value-of select="f:num(qty)"/>,		"price":<xsl:value-of select="f:num(price)"/>,		"sum":<xsl:value-of select="f:num(sum)"/>}	</xsl:for-each>	]}</xsl:template></xsl:stylesheet>