<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE stylesheet [<!ENTITY nbsp "&#160;"><!ENTITY copy "&#x000A9;" >]><xsl:stylesheet		xmlns:xsl="http://www.w3.org/1999/XSL/Transform"		xmlns="http://www.w3.org/1999/xhtml"		xmlns:f="f:f"		version="2.0">	<xsl:output method="html" encoding="UTF-8" media-type="text/html" indent="yes" omit-xml-declaration="yes" exclude-result-prefixes="#all"/>	<!-- ВОЗМОЖНЫЕ ЗНАЧЕНИЯ -->	<!--		new - создание нового BOM. Показать формы для названия и описания		edit - редактирование названия или описания BOM. Показать формы для названия и описания		deleted - BOM удален, показать сообщение о том что удален и закрыть окно		saved - показать сообщение, что BOM сохранен и закрыть окно	-->	<xsl:variable name="result" select="page/variables/result"/>	<xsl:variable name="q" select="page/variables/q"/>	<xsl:variable name="name" select="page/variables/name"/>	<xsl:variable name="desc" select="page/variables/desc"/>	<xsl:variable name="bom_id" select="page/variables/bom"/>	<xsl:template match="/">		<div class="result" id="modal_popup">			<xsl:if test="$result = ('new', 'edit')">				<xsl:variable name="is_new" select="$result = 'new'"/>				<div class="popup__body">					<div class="popup__content">						<a class="popup__close" href="#">X</a>						<div class="popup__title title title_2"><xsl:value-of select="if ($is_new) then 'Новый' else 'Редактировать'"/> BOM</div>						<form action="{page/submit_save}" method="post" ajax="true" ajax-loader-id="modal_popup">							<input type="hidden" name="q" value="{$q}"/>							<input type="hidden" name="bom" value="{$bom_id}"/>							<div class="form__item">								<label class="form-label">Название:</label>								<input class="form__element" name="name" value="{$name}"/>							</div>							<div class="form__item">								<label class="form-label">Примечание:</label>								<input class="form__element" name="desc" value="{$desc}"/>							</div>							<div class="form__proceed">								<input class="button" type="submit" value="Выполнить поиск" />							</div>						</form>					</div>				</div>			</xsl:if>			<xsl:if test="$result = ('deleted', 'saved')">				<xsl:variable name="is_saved" select="$result = 'saved'"/>				<div class="popup__body">					<div class="popup__content">						<a class="popup__close" href="#">X</a>						<div class="popup__title title title_2">BOM <xsl:value-of select="if ($is_saved) then 'сохранен' else 'удален'"/></div>					</div>				</div>				<script>					setTimeout(function() {$('#modal_popup').hide('fade', 100);}, 2000);				</script>			</xsl:if>			<xsl:if test="$result = 'saved_refresh'">				<script>					location.reload();				</script>			</xsl:if>		</div>	</xsl:template>	<!-- 	Вставляется в любое удобное место страницы, где должно быть сохранение BOM -->	<!-- 	Чтобы использовать эту форму должно быть невидимое или видимое поле textarea и чтобы оно было	 		вложено	в элемент с id query_form. Если такого элемента нет, то надо вручную вызывать функцию submitBomSave	 		с нужным селектором		-->	<xsl:template name="SAVE_BOM_FORM">		<div id="bom_save" style="display: none">			<div class="popup__body">				<div class="popup__content">					<a class="popup__close" href="#">X</a>					<div class="popup__title title title_2">Новый BOM</div>					<form action="{page/submit_bom_save}" method="post" ajax="true" ajax-loader-id="modal_popup">						<div class="form__item">							<label class="form-label">Название:</label>							<input class="form__element" name="name" value=""/>						</div>						<div class="form__item">							<label class="form-label">Примечание:</label>							<input class="form__element" name="desc" value=""/>						</div>						<div class="form__proceed">							<input class="button" type="submit" value="Сохранить" />						</div>						<input type="hidden" name="q"/>						<input type="hidden" name="refresh" value="false"/>					</form>				</div>			</div>		</div>		<script>			function submitBomSave(selector, name, desc) {    			if (typeof selector == 'undefined' || selector == '')                    selector = '#query_form';				var q = "";				var noTable = true;				$('.green[query]').each(function () {					var query = $(this).attr('query');					var qty = $(this).attr('qty');					q += query + '\t' + qty + '\n';                    noTable = false;				});				$('table.query_list').find('tr').each(function () {					var query = $(this).find('input').eq(0).val();					var qty = $(this).find('input').eq(1).val();					q += query + ' ' + qty + '\n';					noTable = false;				});				if (noTable) {					q += $(selector).find('textarea').first().val();				}				$('#bom_save').find('input[name=q]').val(q);				$('#modal_popup').html($('#bom_save').html());				$('#modal_popup').show('fade', 100);				initAjax('modal_popup');				if (typeof name != 'undefined') {					$('#modal_popup').find('input[name=name]').val(name);				}				if (typeof desc != 'undefined') {					$('#modal_popup').find('input[name=desc]').val(desc);				}			}            function repeatSearch(selector) {				$(selector).attr('action', '<xsl:value-of select="page/validate_bom_link"/>');				postForm(selector, 'query_form', function() {					$('#modal_popup').show();				});			}		</script>	</xsl:template>	<xsl:template name="SAVE_BOM_BUTTON">		<xsl:param name="query_element_selector" select="'#query_form'"/>		<input class="button" type="button" value="Сохранить список BOM" onclick="submitBomSave('{$query_element_selector}')"/>	</xsl:template></xsl:stylesheet>