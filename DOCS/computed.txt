Вычисляемые параметры айтемов (тип computed).

Вычисляемые параметры - это такие параметры айтема, которые получают свое значение на базе значений других параметров
других айтемов (одного или многих). Например, в системе, в которой у каждого товара может быть много предложений от
разных продавцов, товар может хранить максимальную и минимальную цену предложений и количество предложений.
Еще один пример, если поставить тег разделу новостей, то этот же тег добавляется всем новостям в этом разделе.

Для работы механизма вычисляемых параметров нужно:
1. Определения вычисляемых параметров
2. Реестр наблюдателей за изменениями (типов наблюдателей)
3. Журнал изменений базовых айтемов (на базе которых вычисляются значения вычисляемых параметров)
4. Поток актуализации значений вычисляемых параметров (вычисления параметров) на базе журнала изменений

1.

Хранятся в model.xml рядом с обычными параметрами
При определении вычисляемых параметров указывается (самое важное):
- предок или потомок
- ассоциация
- тип айтема
- параметр

2.

На базе определений вычисляемых параметров можно создать реестр типов наблюдателей.
Тогда при сохранении (удалении) айтема происходит поиск в этом реестре типов айтемов, которые должны реагировать
на изменение сохраняемого айтема. Поскольку операция обновелния вычисляемых значений потенциально трудоемкая,
нужно отслеживать не просто изменение айтема, а изменения конкретных базовых параметров.
Если типы айтемов были найдены (по названию типа, ассоциации и параметру), значит нужно вычислять значения computed
параметров для некоторого множества айтемов. В этом случае в журнале изменений делаестя запись, позволяющая найти
айтемы, которые требуют обновления computed параметров.

3

Если базовый айтем - родитель:

Если базовый айтем - потомок: